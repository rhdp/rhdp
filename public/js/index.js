$(document).ready(function(){var e=io.connect(),t=templatizer,n=[],i=$(document.body),r=($("#header"),$("#toolbar"),$("#search"),$("#topicbar"),$("#topicport")),o=($("#content"),$("#contentport")),a=$("#create"),c=$("#modal"),d=$("#edit");r.escrow(),o.escrow();var l,s,f=CodeMirror.fromTextArea(d.find(".editor")[0],{lineNumbers:!0,lineWrapping:!0,mode:"markdown",theme:"base16-dark"}),u=d.find(".render");i.append(d),d.find(".editwrap").escrow(),u.escrow(),f.refresh(),c.hide(),d.hide();var p=function(){d.is(":hover")||(i.off("click.edit"),c.fadeOut(200),d.fadeOut(200))},h=function(e){e.stopPropagation(),f.setValue(s.md),f.clearHistory(),d.find(".title").val(s.title),m(e)},m=function(e){e.stopPropagation(),c.fadeIn(200),d.fadeIn(200).keyup(),f.refresh(),f.focus(),i.on("click.edit",p)};a.click(m),d.keyup(function(){u.html(marked("#"+d.find(".title").val()+"\n"+f.getValue()))}),o.on("click",".change",h);var w=can.Control.extend({init:function(e,t){this.parent=t.parent},destroy:function(){}}),v=can.Control.extend({init:function(e,t){this.parent=t.parent},click:function(){can.route.attr("article",this.parent.article.title)}});IArticle=can.Construct.extend({setArticle:function(e){l&&l.removeClass("selected"),l=e.entryView.element,s=e.article,o.html(e.view.element.fadeIn(50)),l.addClass("selected")}},{init:function(e){e.html=marked("#"+e.title+"\n"+e.md),this.article=e,this.view=new w(t.article(e),{parent:this}),this.entryView=new v(t.topicnode(e),{parent:this}),r.append(this.entryView.element.hide().fadeIn(50))}});new(can.Control({":article route":function(e){var t=n[e.article];t&&IArticle.setArticle(t)}}))(window);window.location.hash="",can.route.ready(),e.emit("init",{}).on("response",function(){}).on("server.article",function(e){n[e.title]=new IArticle(e)})});